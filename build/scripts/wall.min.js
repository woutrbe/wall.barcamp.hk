!function(){var e=angular.module("wall",["wall.routes","wall.jobModule","wall.jobsModule","wall.jobsDetailModule","wall.menuModule","wall.addJobModule","wall.menuSelectModule","wall.notFound"]);e.run(function(){}),e.controller("WallController",function(){})}(),function(){var e=angular.module("wall.routes",["ngRoute"]);e.config(function(e){e.when("/",{redirectTo:"/filter/all"}).when("/filter/:filter",{templateUrl:"partials/jobs-list.html",controller:"JobsController",resolve:{tmpJobs:function(e,o){return console.log(e.current.params.filter),o.getJobs(0)},menu:function(e){return e.getMenu()}}}).when("/job/:job",{templateUrl:"partials/jobs-detail.html",controller:"JobsDetailController",resolve:{job:function(e,o){return o.getJob(e.current.params.job)},menu:function(e){return e.getMenu()}}}).when("/new",{redirectTo:"/#new"}).when("/404",{templateUrl:"partials/jobs-detail.html",controller:"NotFoundController",resolve:{menu:function(e){return e.getMenu()}}}).otherwise({redirectTo:"/404"})})}(),function(){var e=angular.module("wall.jobModule",["monospaced.elastic","wall.dataService"]);e.directive("job",[function(){return{restrict:"E",templateUrl:"scripts/directives/job/job.html",scope:{job:"="},link:function(e,o,t,n){n.addToMasonry(o,e.job.prepend),o.on("$destroy",function(){n.removeFromMasonry(o)})},controller:"JobController",controllerAs:"jobCtrl"}}])}(),function(){var e=angular.module("wall.jobModule");e.controller("JobController",["$scope","$rootScope","$sce","dataService",function(e,o,t,n){return e.removeContent="Are you sure you want to remove this post?",e.flagContent="Are you sure you want to flag this post?",e.editable=void 0!==e.job.editable?e.job.editable:!1,e.toolbar=void 0!==e.job.toolbar?e.job.toolbar:!0,e.init=function(){e.editable?(e.jobInput="Enter your post here",e.$watch("selectedMenu",function(){e.selectedMenu&&(e.job.cat=e.selectedMenu,e.type="job--"+e.selectedMenu.safeLink,e.maxChars=e.selectedMenu.length)})):e.setContent(e.job)},e.setContent=function(o){var n="http://wall.barcamp.hk/job/"+o.jobLink;e.twitterLink="http://twitter.com/home?status="+o.content.substr(0,50)+" - "+n,e.mailLink="mailto:?body="+o.content+" - "+n,e.type="job--"+o.cat.safeLink,e.content=t.trustAsHtml(o.content),e.timestamp=o.timestamp},e.init(),e.createEditableJob=function(){},e.trash=function(){e.removeable=!0,e.toolbar=!1},e.flag=function(){e.flagable=!0,e.toolbar=!1},e.createPost=function(){var o=e.jobInput,t=e.selectedMenu.id;e.editable=!1,e.job.timestamp=(new Date).getTime(),n.saveJob(o,t).then(function(o){e.job.jobID=o.jobID,e.job.jobLink=o.link,e.job.content=o.content,e.setContent(e.job),e.$emit("wall.masonry.layout")})},e.cancelPost=function(){o.$emit("wall.removeJob",e.job)},e.showTips=function(){e.expanded=!0},e.hideTips=function(){e.expanded=!1},e.confirmRemove=function(){n.removeJob(e.job).then(function(t){"true"===t?o.$emit("wall.removeJob",e.job):(e.removeContent="Sorry, something went wrong, please try again later.",e.removeFailed=!0)})},e.cancelRemove=function(){e.removeable=!1,e.toolbar=!0,e.removeContent="Are you sure you want to remove this post?",e.removeFailed=!1},e.confirmFlag=function(){n.flagJob(e.job).then(function(t){"true"===t?o.$emit("wall.removeJob",e.job):"flag"===t?(e.flagContent="Thank you, one of our admins has been notified of this post.",e.flagged=!0,e.flagFailed=!0):(e.flagContent="Sorry, something went wrong, please try again later.",e.flagFailed=!0)})},e.cancelFlag=function(){e.flagable=!1,e.toolbar=!0,e.flagContent="Are you sure you want to flag this post?",e.flagFailed=!1},e.addToMasonry=function(o,t){e.$emit("wall.masonry.addToMasonry",o,t)},e.removeFromMasonry=function(o){e.$emit("wall.masonry.removeFromMasonry",o)},e}])}(),function(){var e=angular.module("wall.loginModule",[]);e.directive("login",function(){return{restrict:"E",templateUrl:"scripts/directives/login/login.html",controller:function(){},controllerAs:"loginCtrl"}})}(),function(){var e=angular.module("wall.menuModule",["wall.dataService"]);e.directive("menu",["dataService",function(e){return{restrict:"E",templateUrl:"scripts/directives/menu/menu.html",controller:function(o){return o.links=[{color:"242, 90, 149",id:"0",link:"View all",safeLink:"all"}],e.getMenu().then(function(e){o.links=o.links.concat(e)}),o.mouseoverHandler=function(e,o){angular.element(e.srcElement)[0].style.backgroundColor="rgb("+o+")"},o.mouseoutHandler=function(e){angular.element(e.srcElement)[0].style.backgroundColor="rgb(255, 255, 255)"},o},controllerAs:"menuCtrl"}}])}(),function(){var e=angular.module("wall.menuSelectModule",["wall.dataService"]);e.directive("menuSelect",["dataService",function(e){return{restrict:"E",templateUrl:"scripts/directives/menu-select/menu-select.html",scope:{selected:"=selectedMenu"},controller:function(o){return e.getMenu().then(function(e){o.links=e,o.selectedLink=o.links[0],o.selected=o.selectedLink}),o.update=function(){o.selected=o.selectedLink},o},controllerAs:"menuSelectCtrl"}}])}(),function(){var e=angular.module("wall.masonry",[]);e.directive("masonry",[function(){return{restrict:"A",scope:!0,link:function(e,o,t,n){e.msnry=new Masonry(o[0],{itemSelector:".job-container"}),e.$on("wall.masonry.addToMasonry",function(e,o,t){n.addToMasonry(o,t)}),e.$on("wall.masonry.removeFromMasonry",function(e,o){n.removeFromMasonry(o)}),e.$on("wall.masonry.layout",function(){n.layout()})},controller:"MasonryController"}}])}(),function(){var e=angular.module("wall.masonry");e.controller("MasonryController",["$scope",function(e){return e.addTimeout=null,e.itemsToAdd=[],e.prepend=!1,e.addToMasonry=function(o,t){window.clearTimeout(e.addTimeout),e.prepend=t,e.itemsToAdd.push(o[0]),e.addTimeout=window.setTimeout(function(){e.prepend?e.msnry.prepended(e.itemsToAdd):e.msnry.appended(e.itemsToAdd),e.layout(),e.itemsToAdd=[]},100)},e.removeFromMasonry=function(o){e.msnry.remove(o),e.layout()},e.layout=function(){e.msnry.layout()},e}])}(),function(){var e=angular.module("wall.infinite-scroll",[]);e.directive("infiniteScroll",[function(){return{restrict:"A",scope:!0,controller:"InfiniteScrollController"}}])}()(function(){var e=angular.module("wall.infinite-scroll");e.controller("InfiniteScrollController",[function(){}])})()(function(){var e=angular.module("wall.jobsModule",["wall.dataService","wall.masonry"]);e.controller("JobsController",["$scope","$rootScope","$location","$http","dataService","tmpJobs","menu",function(e,o,t,n,r,l,a){return e.jobs=[],e.$on("$routeUpdate",function(){console.log(t.search()),console.log(t.hash())}),e.matchJobWithMenu=function(o,t){for(var n={},r=0;r<o.length;r++){n=o[r];var l=_.filter(t,{id:n.catID.toString()});n.cat=l[0],e.jobs.push(n)}},e.matchJobWithMenu(l,a),o.$on("wall.newJob",function(){var o={catID:0,content:"test",timestamp:(new Date).getTime(),link:"",editable:!0,removeable:!1,prepend:!0};e.jobs.unshift(o)}),o.$on("wall.removeJob",function(o,t){e.jobs=_.without(e.jobs,t)}),e}])})(),function(){var e=angular.module("wall.jobsDetailModule",[]);e.controller("JobsDetailController",["$scope","$rootScope","$location","job",function(e,o,t,n){return(void 0===n||"null"===n)&&t.path("/404"),n.cat.safeLink=n.cat.link.toLowerCase().replace(/ /g,"-"),e.job=n,e}])}(),function(){var e=angular.module("wall.addJobModule",[]);e.controller("AddJobController",function(e,o){return e.addNewJob=function(){o.$emit("wall.newJob")},e})}(),function(){var e=angular.module("wall.notFound",[]);e.controller("NotFoundController",["$scope","$rootScope",function(e){e.job={catID:0,content:"Blah blah not found",timestamp:(new Date).getTime(),link:"",toolbar:!1,cat:{safeLink:"admin-notice",link:"Admin Notice"}}}])}(),function(){var e=angular.module("wall.dataService",[]);e.factory("dataService",["$http","$q",function(e,o){var t=[],n=[],r=!1,l=o.defer();return{getMenu:function(){return t.length>0?l.resolve(t):(r||e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"getCats"}}).success(function(e){t=e,_.each(t,function(e){e.safeLink=e.link.toLowerCase().replace(/ /g,"-")}),l.resolve(t)}),r=!0),l.promise},getJobs:function(t){var r=o.defer();return e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"getJobs",page:t}}).success(function(e){n=e,r.resolve(e)}),r.promise},getJob:function(t){var n=o.defer();return e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"getJob",link:t}}).success(function(e){n.resolve(e)}),n.promise},saveJob:function(t,n){var r=o.defer();return e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"saveJob",content:t,catID:n},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}),r.promise},removeJob:function(t){var n=o.defer();return e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"deleteJob",jobID:t.jobID}}).success(function(e){n.resolve(e)}),n.promise},flagJob:function(t){var n=o.defer();return e({method:"POST",url:"../server/api.php",data:{ajax:!0,action:"flagJob",jobID:t.jobID}}).success(function(e){n.resolve(e)}),n.promise}}}])}();